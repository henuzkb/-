<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç”Ÿåº§ä½è¡¨ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: #3f51b5;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .btn i {
            margin-right: 5px;
        }
        
        .btn-primary {
            background: #3f51b5;
            color: white;
        }
        
        .btn-primary:hover {
            background: #303f9f;
        }
        
        .btn-secondary {
            background: #607d8b;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #455a64;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #388e3c;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #f57c00;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        .file-input {
            display: none;
        }
        
        .classroom-container {
            padding: 20px;
            overflow-x: auto;
        }
        
        .classroom {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .seat {
            width: 100%;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            cursor: move;
            font-size: 14px;
            text-align: center;
            padding: 5px;
            box-sizing: border-box;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            word-break: break-all;
            overflow: hidden;
        }
        
        .seat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .seat.empty {
            background: #e0e0e0;
            color: #757575;
        }
        
        .seat.boy {
            background: #bbdefb;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }
        
        .seat.girl {
            background: #ffcdd2;
            color: #d32f2f;
            border-left: 4px solid #d32f2f;
        }
        
        .seat.moving {
            opacity: 0.7;
            transform: scale(0.95);
        }
        
        .teacher-area {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 20px;
        }
        
        .teacher-desk {
            grid-column: 3 / span 4;
            height: 50px;
            background: #c8e6c9;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            color: #388e3c;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .student-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
        }
        
        .color-sample {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 5px;
        }
        
        .boy-sample {
            background: #bbdefb;
        }
        
        .girl-sample {
            background: #ffcdd2;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            font-size: 12px;
            color: #666;
            border-top: 1px solid #eaeaea;
        }
        
        @media print {
            @page {
                size: A4 landscape;
                margin: 1cm;
            }
            body * {
                visibility: hidden;
            }
            .container, .container * {
                visibility: visible;
            }
            .container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            .controls, footer, .student-info {
                display: none;
            }
            .seat {
                border: 1px solid #ddd;
                box-shadow: none;
                font-size: 16px !important;
                font-weight: bold;
                height: 50px;
            }
            .seat.empty {
                visibility: hidden;
                border: none;
            }
            .teacher-area {
                margin-top: 30px;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .controls {
                justify-content: center;
            }
            .btn {
                min-width: 100px;
                font-size: 12px;
                padding: 6px 10px;
            }
            .classroom {
                grid-template-columns: repeat(4, 1fr);
            }
            .teacher-desk {
                grid-column: 2 / span 2;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 5px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å­¦ç”Ÿåº§ä½è¡¨ç®¡ç†ç³»ç»Ÿ</h1>
            <div class="subtitle">æè‰³é˜ä¸­åŸåå¸ˆå·¥ä½œå®¤ï¼š å¼ å…‹å½¬</div>
        </header>
        
        <div class="controls">
            <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
            <button class="btn btn-primary" id="importBtn">
                <i>ğŸ“</i> å¯¼å…¥Excel
            </button>
            <button class="btn btn-secondary" id="downloadTemplateBtn">
                <i>ğŸ“‹</i> ä¸‹è½½æ¨¡æ¿
            </button>
            <button class="btn btn-warning" id="addStudentBtn">
                <i>â•</i> å¢åŠ å­¦ç”Ÿ
            </button>
            <button class="btn btn-warning" id="removeStudentBtn">
                <i>â–</i> å‡å°‘å­¦ç”Ÿ
            </button>
            <button class="btn btn-secondary" id="randomBtn">
                <i>ğŸ”€</i> éšæœºæ’åº§
            </button>
            <button class="btn btn-success" id="saveBtn">
                <i>ğŸ’¾</i> ä¿å­˜
            </button>
            <button class="btn btn-danger" id="clearBtn">
                <i>ğŸ—‘ï¸</i> æ¸…ç©º
            </button>
            <button class="btn btn-primary" id="printBtn">
                <i>ğŸ–¨ï¸</i> æ‰“å°
            </button>
            <button class="btn btn-success" id="exportWordBtn">
                <i>ğŸ“„</i> å¯¼å‡ºWord
            </button>
        </div>
        
        <div class="classroom-container">
            <div class="classroom" id="classroom">
                <!-- åº§ä½å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="teacher-area">
                <div class="teacher-desk">è®²å°</div>
            </div>
            
            <div class="student-info">
                <div class="info-item">
                    <div class="color-sample boy-sample"></div>
                    <span>ç”·ç”Ÿ</span>
                </div>
                <div class="info-item">
                    <div class="color-sample girl-sample"></div>
                    <span>å¥³ç”Ÿ</span>
                </div>
                <div class="info-item">
                    <span>æ€»äººæ•°: <span id="totalStudents">0</span></span>
                </div>
                <div class="info-item">
                    <span>ç”·ç”Ÿ: <span id="boyCount">0</span></span>
                </div>
                <div class="info-item">
                    <span>å¥³ç”Ÿ: <span id="girlCount">0</span></span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å­¦ç”Ÿåº§ä½è¡¨ç®¡ç†ç³»ç»Ÿ &copy; 2023 - æ‹–åŠ¨åº§ä½å¯äº¤æ¢ä½ç½®ï¼Œæ”¯æŒExcelå¯¼å…¥å¯¼å‡º</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const classroom = document.getElementById('classroom');
            const importBtn = document.getElementById('importBtn');
            const fileInput = document.getElementById('fileInput');
            const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
            const addStudentBtn = document.getElementById('addStudentBtn');
            const removeStudentBtn = document.getElementById('removeStudentBtn');
            const randomBtn = document.getElementById('randomBtn');
            const saveBtn = document.getElementById('saveBtn');
            const clearBtn = document.getElementById('clearBtn');
            const printBtn = document.getElementById('printBtn');
            const exportWordBtn = document.getElementById('exportWordBtn');
            const totalStudentsEl = document.getElementById('totalStudents');
            const boyCountEl = document.getElementById('boyCount');
            const girlCountEl = document.getElementById('girlCount');
            
            let students = [];
            let seats = Array(72).fill(null); // 9è¡Œ8åˆ—å…±72ä¸ªåº§ä½
            let draggedSeat = null;
            
            // åˆå§‹åŒ–æ•™å®¤åº§ä½
            function initClassroom() {
                classroom.innerHTML = '';
                
                for (let i = 0; i < 72; i++) {
                    const seat = document.createElement('div');
                    seat.className = 'seat empty';
                    seat.textContent = 'ç©º';
                    seat.dataset.index = i;
                    
                    if (seats[i]) {
                        const student = seats[i];
                        seat.className = `seat ${student.gender === 'ç”·' ? 'boy' : 'girl'}`;
                        seat.textContent = `${student.name}`;
                        if (student.rank) {
                            seat.textContent += `ï¼ˆ${student.rank}ï¼‰`;
                        }
                        seat.dataset.studentName = student.name;
                    }
                    
                    // æ·»åŠ æ‹–æ‹½äº‹ä»¶
                    seat.draggable = true;
                    seat.addEventListener('dragstart', handleDragStart);
                    seat.addEventListener('dragover', handleDragOver);
                    seat.addEventListener('dragenter', handleDragEnter);
                    seat.addEventListener('dragleave', handleDragLeave);
                    seat.addEventListener('drop', handleDrop);
                    seat.addEventListener('dragend', handleDragEnd);
                    
                    classroom.appendChild(seat);
                }
                
                updateStudentCount();
            }
            
            // æ›´æ–°å­¦ç”Ÿç»Ÿè®¡
            function updateStudentCount() {
                const total = students.length;
                const boys = students.filter(s => s.gender === 'ç”·').length;
                const girls = total - boys;
                
                totalStudentsEl.textContent = total;
                boyCountEl.textContent = boys;
                girlCountEl.textContent = girls;
            }
            
            // ä¸‹è½½Excelæ¨¡æ¿
            function downloadExcelTemplate() {
                // åˆ›å»ºç¤ºä¾‹æ•°æ®
                const templateData = [
                    { å§“å: 'å¼ ä¸‰', æ€§åˆ«: 'ç”·', åæ¬¡: '1' },
                    { å§“å: 'æå››', æ€§åˆ«: 'å¥³', åæ¬¡: '2' },
                    { å§“å: 'ç‹äº”', æ€§åˆ«: 'ç”·', åæ¬¡: '3' },
                    { å§“å: 'èµµå…­', æ€§åˆ«: 'å¥³', åæ¬¡: '4' }
                ];
                
                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(templateData);
                
                // å°†å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(wb, ws, 'å­¦ç”Ÿåå•');
                
                // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
                XLSX.writeFile(wb, 'å­¦ç”Ÿåº§ä½è¡¨æ¨¡æ¿.xlsx');
            }
            
            // å¯¼å‡ºåˆ°Word
            function exportToWord() {
                // åˆ›å»ºWordæ–‡æ¡£çš„HTMLå†…å®¹
                const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        @page {
                            size: A4 landscape;
                            margin: 1cm;
                        }
                        body {
                            font-family: 'Microsoft YaHei', sans-serif;
                            margin: 0;
                            padding: 0;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            table-layout: fixed;
                        }
                        td {
                            border: 1px solid #000;
                            height: 40px;
                            text-align: center;
                            vertical-align: middle;
                            font-size: 16px; /* å°äºŒå·å­— */
                            font-weight: bold;
                            padding: 5px;
                            page-break-inside: avoid;
                        }
                        .teacher-desk {
                            height: 30px;
                            font-weight: bold;
                            background-color: #f0f0f0;
                        }
                    </style>
                </head>
                <body>
                    <table>
                        ${generateWordTableRows()}
                        <tr>
                            <td colspan="8" class="teacher-desk">è®²å°</td>
                        </tr>
                    </table>
                </body>
                </html>
                `;
                
                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([htmlContent], { type: 'application/msword' });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `å­¦ç”Ÿåº§ä½è¡¨_${new Date().toLocaleDateString()}.doc`;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // ç”ŸæˆWordè¡¨æ ¼çš„è¡Œ
            function generateWordTableRows() {
                let rows = '';
                
                // åˆ›å»º9è¡Œ8åˆ—çš„è¡¨æ ¼
                for (let row = 0; row < 9; row++) {
                    rows += '<tr>';
                    
                    for (let col = 0; col < 8; col++) {
                        const index = row * 8 + col;
                        const student = seats[index];
                        
                        rows += `<td>${student ? student.name : ''}</td>`;
                    }
                    
                    rows += '</tr>';
                }
                
                return rows;
            }
            
            // æ‹–æ‹½å¼€å§‹
            function handleDragStart(e) {
                draggedSeat = this;
                this.classList.add('moving');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            // æ‹–æ‹½ç»è¿‡
            function handleDragOver(e) {
                if (e.preventDefault) {
                    e.preventDefault();
                }
                e.dataTransfer.dropEffect = 'move';
                return false;
            }
            
            // æ‹–æ‹½è¿›å…¥
            function handleDragEnter(e) {
                this.classList.add('moving');
            }
            
            // æ‹–æ‹½ç¦»å¼€
            function handleDragLeave(e) {
                this.classList.remove('moving');
            }
            
            // æ‹–æ‹½æ”¾ç½®
            function handleDrop(e) {
                if (e.stopPropagation) {
                    e.stopPropagation();
                }
                
                // å¦‚æœä¸æ˜¯åŒä¸€ä¸ªåº§ä½æ‰äº¤æ¢
                if (draggedSeat !== this) {
                    // äº¤æ¢ä¸¤ä¸ªåº§ä½çš„æ•°æ®
                    const fromIndex = parseInt(draggedSeat.dataset.index);
                    const toIndex = parseInt(this.dataset.index);
                    
                    // äº¤æ¢æ•°æ®
                    const temp = seats[fromIndex];
                    seats[fromIndex] = seats[toIndex];
                    seats[toIndex] = temp;
                    
                    // æ›´æ–°UI
                    updateSeatUI(fromIndex);
                    updateSeatUI(toIndex);
                }
                
                return false;
            }
            
            // æ‹–æ‹½ç»“æŸ
            function handleDragEnd(e) {
                this.classList.remove('moving');
                document.querySelectorAll('.seat').forEach(seat => {
                    seat.classList.remove('moving');
                });
            }
            
            // æ›´æ–°å•ä¸ªåº§ä½çš„UI
            function updateSeatUI(index) {
                const seatElement = document.querySelector(`.seat[data-index="${index}"]`);
                
                if (seats[index]) {
                    const student = seats[index];
                    seatElement.className = `seat ${student.gender === 'ç”·' ? 'boy' : 'girl'}`;
                    seatElement.textContent = `${student.name}`;
                    if (student.rank) {
                        seatElement.textContent += `ï¼ˆ${student.rank}ï¼‰`;
                    }
                    seatElement.dataset.studentName = student.name;
                } else {
                    seatElement.className = 'seat empty';
                    seatElement.textContent = 'ç©º';
                    delete seatElement.dataset.studentName;
                }
                
                // é‡æ–°ç»‘å®šäº‹ä»¶
                seatElement.draggable = true;
                seatElement.addEventListener('dragstart', handleDragStart);
                seatElement.addEventListener('dragover', handleDragOver);
                seatElement.addEventListener('dragenter', handleDragEnter);
                seatElement.addEventListener('dragleave', handleDragLeave);
                seatElement.addEventListener('drop', handleDrop);
                seatElement.addEventListener('dragend', handleDragEnd);
            }
            
            // å¯¼å…¥Excelæ–‡ä»¶
            importBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        
                        students = jsonData.map(row => {
                            // å°è¯•ä¸åŒçš„åˆ—åå¯èƒ½
                            const name = row['å§“å'] || row['åå­—'] || row['name'] || row['Name'] || '';
                            const gender = row['æ€§åˆ«'] || row['gender'] || row['Gender'] || 'ç”·';
                            const rank = row['åæ¬¡'] || row['æ’å'] || row['rank'] || row['Rank'] || '';
                            
                            return { name, gender, rank };
                        }).filter(student => student.name.trim() !== ''); // è¿‡æ»¤ç©ºå§“å
                        
                        if (students.length === 0) {
                            alert('æœªæ‰¾åˆ°æœ‰æ•ˆå­¦ç”Ÿæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼ï¼');
                            return;
                        }
                        
                        // æ¸…ç©ºåº§ä½
                        seats = Array(72).fill(null);
                        
                        // å°†å­¦ç”Ÿéšæœºåˆ†é…åˆ°å‰Nä¸ªåº§ä½
                        const shuffledStudents = [...students].sort(() => Math.random() - 0.5);
                        for (let i = 0; i < Math.min(shuffledStudents.length, 72); i++) {
                            seats[i] = shuffledStudents[i];
                        }
                        
                        initClassroom();
                        alert(`æˆåŠŸå¯¼å…¥ ${students.length} åå­¦ç”Ÿæ•°æ®ï¼`);
                    } catch (error) {
                        console.error('å¯¼å…¥Excelå‡ºé”™:', error);
                        alert('å¯¼å…¥Excelæ–‡ä»¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                    }
                };
                reader.readAsArrayBuffer(file);
            });
            
            // å¢åŠ å­¦ç”Ÿ
            addStudentBtn.addEventListener('click', function() {
                const name = prompt("è¯·è¾“å…¥å­¦ç”Ÿå§“å:");
                if (!name || name.trim() === '') return;
                
                let gender = prompt("è¯·è¾“å…¥å­¦ç”Ÿæ€§åˆ«(ç”·/å¥³):", "ç”·");
                if (!gender) return;
                
                // æ ‡å‡†åŒ–æ€§åˆ«è¾“å…¥
                if (gender !== 'ç”·' && gender !== 'å¥³') {
                    gender = 'ç”·'; // é»˜è®¤å€¼
                }
                
                const rank = prompt("è¯·è¾“å…¥å­¦ç”Ÿåæ¬¡ï¼ˆå¯é€‰ï¼‰:", "");
                
                const newStudent = {
                    name: name.trim(),
                    gender: gender,
                    rank: rank || ""
                };
                
                students.push(newStudent);
                
                // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºåº§ä½
                const emptySeatIndex = seats.findIndex(seat => seat === null);
                if (emptySeatIndex !== -1) {
                    seats[emptySeatIndex] = newStudent;
                    updateSeatUI(emptySeatIndex);
                    updateStudentCount();
                } else {
                    alert("æ²¡æœ‰ç©ºåº§ä½äº†ï¼");
                }
            });
            
            // å‡å°‘å­¦ç”Ÿ
            removeStudentBtn.addEventListener('click', function() {
                if (students.length === 0) {
                    alert("æ²¡æœ‰å­¦ç”Ÿå¯ç§»é™¤ï¼");
                    return;
                }
                
                const studentList = students.map((s, i) => `${i+1}. ${s.name} (${s.gender})`).join('\n');
                const studentName = prompt(`è¯·è¾“å…¥è¦ç§»é™¤çš„å­¦ç”Ÿå§“å:\n\nå½“å‰å­¦ç”Ÿåˆ—è¡¨:\n${studentList}`);
                if (!studentName) return;
                
                const studentIndex = students.findIndex(s => s.name === studentName);
                if (studentIndex === -1) {
                    alert("æœªæ‰¾åˆ°è¯¥å­¦ç”Ÿï¼");
                    return;
                }
                
                // ä»åº§ä½ä¸­ç§»é™¤è¯¥å­¦ç”Ÿ
                const seatIndex = seats.findIndex(seat => seat && seat.name === studentName);
                if (seatIndex !== -1) {
                    seats[seatIndex] = null;
                    updateSeatUI(seatIndex);
                }
                
                // ä»å­¦ç”Ÿåˆ—è¡¨ä¸­ç§»é™¤
                students.splice(studentIndex, 1);
                updateStudentCount();
            });
            
            // éšæœºæ’åº§
            randomBtn.addEventListener('click', function() {
                if (students.length === 0) {
                    alert('è¯·å…ˆå¯¼å…¥æˆ–æ·»åŠ å­¦ç”Ÿï¼');
                    return;
                }
                
                // è¿‡æ»¤å‡ºå·²åˆ†é…çš„å­¦ç”Ÿ
                const assignedStudents = seats.filter(student => student !== null);
                
                // éšæœºæ‰“ä¹±å­¦ç”Ÿé¡ºåº
                const shuffledStudents = [...assignedStudents].sort(() => Math.random() - 0.5);
                
                // æ¸…ç©ºåº§ä½
                seats = Array(72).fill(null);
                
                // é‡æ–°åˆ†é…åº§ä½
                for (let i = 0; i < shuffledStudents.length; i++) {
                    if (i >= 72) break;
                    seats[i] = shuffledStudents[i];
                }
                
                initClassroom();
            });
            
            // ä¿å­˜åº§ä½è¡¨
            saveBtn.addEventListener('click', function() {
                const dataToSave = {
                    students: students,
                    seats: seats,
                    savedAt: new Date().toISOString()
                };
                
                localStorage.setItem('classroomSeatingChart', JSON.stringify(dataToSave));
                alert('åº§ä½è¡¨å·²ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼');
            });
            
            // æ¸…ç©ºåº§ä½è¡¨
            clearBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åº§ä½è¡¨æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                    students = [];
                    seats = Array(72).fill(null);
                    initClassroom();
                    localStorage.removeItem('classroomSeatingChart');
                }
            });
            
            // æ‰“å°åº§ä½è¡¨
            printBtn.addEventListener('click', function() {
                window.print();
            });
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            downloadTemplateBtn.addEventListener('click', downloadExcelTemplate);
            exportWordBtn.addEventListener('click', exportToWord);
            
            // å°è¯•åŠ è½½ä¿å­˜çš„åº§ä½è¡¨
            function loadSavedSeating() {
                const savedData = localStorage.getItem('classroomSeatingChart');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        students = parsedData.students || [];
                        seats = parsedData.seats || Array(72).fill(null);
                        initClassroom();
                    } catch (e) {
                        console.error('åŠ è½½ä¿å­˜çš„æ•°æ®å¤±è´¥:', e);
                    }
                }
            }
            
            // åˆå§‹åŒ–
            loadSavedSeating();
            initClassroom();
        });
    </script>
</body>
</html>
